var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,s=(t,a,l)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l,i=(e,t)=>{for(var a in t||(t={}))n.call(t,a)&&s(e,a,t[a]);if(l)for(var a of l(t))r.call(t,a)&&s(e,a,t[a]);return e},o=(e,l)=>t(e,a(l)),c=e=>"symbol"==typeof e?e:e+"",m=(e,t)=>{var a={};for(var s in e)n.call(e,s)&&t.indexOf(s)<0&&(a[s]=e[s]);if(null!=e&&l)for(var s of l(e))t.indexOf(s)<0&&r.call(e,s)&&(a[s]=e[s]);return a};import{T as u,R as d,c as p,I as E,S as g,F as C,r as h,H as v,C as f,a as b,b as N,d as _,e as y,B as I,M as T,f as P,g as S,h as k,i as A,P as x,j as w,U as M,k as R,l as O,A as D,m as L,n as U,o as z,p as F,u as K,q as G,s as B,t as $,v as j,w as V,x as Y,N as H,y as W,D as J,z as q,E as Q,G as X,J as Z,K as ee,L as te,O as ae,Q as le,V as ne,W as re}from"./philter-manager.vendor.js";const se=Object.freeze({AUTO:0,BREAK:0,CLAN:0,CLST:0,DISC:0,DISP:0,GIFT:0,KEEP:0,MAKE:0,MALL:0,PULV:0,TODO:0,UNTN:0,USE:0});class ie extends Error{constructor(e,t,a){super(e),this.code=t,this.response=a}}ie.prototype.name="ApiError";const oe=async(e,t,a)=>{const l=function(e){const t={};for(const l of Object.keys(e))if("method"===(a=l)||"path"===a)t[l]=e[l];else{const a=JSON.stringify(e[l]);void 0!==a&&(t[l]=a)}var a;return t}(i({path:e,method:t},a)),n=await fetch("/relay_Philter_Manager.js?relay=true",{body:new URLSearchParams(l),method:"POST"});if(!n.ok){let e;try{e=await n.text()}catch(s){console.error(s)}throw new ie(n.statusText,n.status,e)}let r;try{r=await n.json()}catch(o){throw new ie(`Invalid JSON returned from server (${o})\nResponse: ${r}`,500,r)}if("error"in r)throw new ie(r.error.message,r.error.code,r.error.message);return r},ce=e=>oe("/ruleset","post",{cleanupRules:e}),me=u.create({maxToasts:1}),ue=(e,t,a)=>{t?me.show({icon:"warning-sign",intent:"warning",message:t instanceof ie?d.createElement(d.Fragment,null,a,": ",t.message,d.createElement("br",null),"Response: ",String(t.response)):`${a}: ${t}`},e):me.dismiss(e)},de=(e,t,a)=>{t?me.show({icon:"floppy-disk",intent:"primary",message:a},e):me.dismiss(e)},pe=e=>!e.isTradable;const Ee=e=>{var t=e,{className:a,fill:l,small:n}=t,r=m(t,["className","fill","small"]);return d.createElement("input",i({className:p("NumericInputLite",E,n&&g,l&&C,a),dir:"auto",type:"number"},r))};const ge=e=>"UNKN"===e||(e=>"string"==typeof e&&Object.prototype.hasOwnProperty.call(se,e))(e),Ce=h.exports.memo((function(e){var t=e,{className:a,item:l,onChange:n,value:r}=t,s=m(t,["className","item","onChange","value"]);return d.createElement("div",i({className:p(v,"SelectCleanupAction",a)},s),d.createElement("select",{onChange:e=>ge(e.target.value)&&n(e.target.value),value:r},d.createElement("option",{value:"UNKN"},"(uncategorized)"),d.createElement("option",{value:"KEEP"},"Keep all"),l.canMall&&d.createElement("option",{value:"MALL"},"Mall sale"),l.canBreak&&d.createElement("option",{value:"BREAK"},"Break apart"),l.canAutosell&&d.createElement("option",{value:"AUTO"},"Autosell"),l.canDiscard&&d.createElement("option",{style:{color:f.ORANGE2},value:"DISC"},"Discard"),l.canGift&&d.createElement("option",{value:"GIFT"},"Send as gift"),l.canStash&&d.createElement("option",{value:"CLAN"},"Put in clan stash"),l.canPulverize&&d.createElement("option",{style:pe(l)?{color:f.ORANGE2}:void 0,value:"PULV"},"Pulverize"),l.canMake&&d.createElement("option",{value:"MAKE"},"Craft..."),l.canUntinker&&d.createElement("option",{value:"UNTN"},"Untinker"),l.canUse&&d.createElement("option",{value:"USE"},"Use"),l.canCloset&&d.createElement("option",{value:"CLST"},"Closet"),l.canDisplay&&d.createElement("option",{value:"DISP"},"Display"),d.createElement("option",{value:"TODO"},"Reminder")))})),he=({item:e,rule:t,onChange:a})=>{const l=h.exports.useCallback((e=>{a&&a((t=>e===(null==t?void 0:t.action)?t:"UNKN"===e?null:o(i({},t),"GIFT"===e?{action:e,message:"",recipent:""}:"MAKE"===e?{action:e,shouldUseCreatableOnly:!1,targetItem:""}:"MALL"===e?{action:e,minPrice:0}:"TODO"===e?{action:e,message:""}:{action:e})))}),[a]);let n,r;return t&&("PULV"===t.action&&pe(e)?(n="You will pulverize an untradable item.",r=N.WARNING):"DISC"===t.action&&(n="You will gain no meat from discarding.",r=N.WARNING)),d.createElement(b,{className:"CleanupRulePicker",helperText:n,intent:r},d.createElement("div",{className:"CleanupRulePicker__Inputs"},d.createElement(Ce,{className:"CleanupRulePicker__Child",item:e,onChange:l,value:t?t.action:"UNKN"}),t?"GIFT"===t.action?d.createElement(d.Fragment,null,d.createElement(b,{className:"CleanupRulePicker__Child",contentClassName:"CleanupRulePicker__InputGiftRecipent",helperText:!t.recipent&&"No recipent name",inline:!0,intent:t.recipent?void 0:N.DANGER,label:"to"},d.createElement("input",{className:p(E,g,!t.recipent&&_,"CleanupRulePicker__InputText"),onChange:e=>null==a?void 0:a(o(i({},t),{recipent:e.target.value})),placeholder:"Player name",type:"text",value:t.recipent})),d.createElement(b,{className:"CleanupRulePicker__Child",contentClassName:"CleanupRulePicker__InputGiftMessage",inline:!0,label:"with"},d.createElement("input",{className:p(E,g,"CleanupRulePicker__InputText"),onChange:e=>null==a?void 0:a(o(i({},t),{message:e.target.value})),placeholder:"Kmail message",type:"text",value:t.message}))):"MAKE"===t.action?d.createElement(d.Fragment,null,d.createElement(b,{className:"CleanupRulePicker__Child",contentClassName:"CleanupRulePicker__InputMakeTarget",helperText:!t.targetItem&&"No item name",inline:!0,intent:t.targetItem?void 0:N.DANGER,label:"into"},d.createElement("input",{className:p(E,g,"CleanupRulePicker__InputText"),onChange:e=>null==a?void 0:a(o(i({},t),{targetItem:e.target.value})),placeholder:"Item name",type:"text",value:t.targetItem})),d.createElement(y,{checked:t.shouldUseCreatableOnly,className:"CleanupRulePicker__Child CleanupRulePicker__Checkbox",onChange:e=>null==a?void 0:a(o(i({},t),{shouldUseCreatableOnly:e.currentTarget.checked}))},d.createElement("span",{className:"CleanupRulePicker__CheckBoxText"},"Only use available ingredients"))):"MALL"===t.action?d.createElement(b,{className:"CleanupRulePicker__Child",contentClassName:"CleanupRulePicker__InputMallMinPrice",inline:!0,label:"min price"},d.createElement(Ee,{max:999999999,min:0,onChange:e=>{const l=Number(e.target.value);Number.isInteger(l)&&(null==a||a(o(i({},t),{minPrice:Math.max(0,Math.min(999999999,l))})))},value:t.minPrice})):"TODO"===t.action?d.createElement(b,{className:"CleanupRulePicker__Child",contentClassName:"CleanupRulePicker__InputTodoMessage",inline:!0,label:"with message:"},d.createElement("input",{className:p(E,g,"CleanupRulePicker__InputText"),onChange:e=>null==a?void 0:a(o(i({},t),{message:e.target.value})),placeholder:"Enter reminder message",type:"text",value:t.message})):null:null))};var ve,fe;(fe=ve||(ve={})).ITEM_NAME="ITEM_NAME",fe.CLOSET_AMOUNT="CLOSET_AMOUNT",fe.STORAGE_AMOUNT="STORAGE_AMOUNT",fe.DISPLAY_CASE_AMOUNT="DISPLAY_CASE_AMOUNT",fe.MALL_PRICE="MALL_PRICE";const be=e=>{throw new Error(`${e} is not a key for a sortable column`)},Ne=()=>{const[e,t]=h.exports.useState({sortBy:void 0,sortDirection:P.ASC});return o(i({},e),{updateSortState:h.exports.useCallback((({sortBy:e})=>{return t((a=e,e=>e.sortBy&&e.sortBy===a?e.sortDirection===P.ASC?{sortBy:e.sortBy,sortDirection:P.DESC}:{sortBy:void 0,sortDirection:P.ASC}:{sortBy:a,sortDirection:P.ASC}));var a}),[])})},_e=({dataKey:e,disableSort:t,label:a,sortBy:l,sortDirection:n})=>{const r=d.createElement("span",{className:"TableItemCleanup__HeaderCellLabel"},a);if(t)return r;let s,i,o;return l===e?(i="primary",s=(e=>{switch(e){case ve.ITEM_NAME:return{asc:"sort-alphabetical",desc:"sort-alphabetical-desc"};case ve.CLOSET_AMOUNT:case ve.STORAGE_AMOUNT:case ve.DISPLAY_CASE_AMOUNT:case ve.MALL_PRICE:return{asc:"sort-numerical",desc:"sort-numerical-desc"}}be(e)})(e)[n===P.ASC?"asc":"desc"]):(o=f.GRAY4,s="double-caret-vertical"),d.createElement(d.Fragment,null,r,d.createElement(U,{color:o,icon:s,intent:i}))},ye=()=>d.createElement("span",{className:p(z,T,F,"TableItemCleanup__ColumnMallPrice--minimum"),title:"Is at minimum mall price"},"min"),Ie=h.exports.memo((function({inventory:e,item:t}){return d.createElement(d.Fragment,null,d.createElement("a",{className:p(I,T,"TableItemCleanup__ItemImageLink"),onClick:()=>{return e=t.descid,void(null==(a=window.open(`/desc_item.php?whichitem=${e}`,"name","height=200,width=214"))||a.focus());var e,a},tabIndex:0,title:"View item description"},d.createElement("img",{className:"TableItemCleanup__ItemImage",alt:t.name,src:`/images/itemimages/${t.image}`})),d.createElement("a",{className:p(I,T,"TableItemCleanup__ItemNameLink"),href:`https://kol.coldfront.net/thekolwiki/index.php/Special:Search?search=${t.name}&go=Go`,rel:"noopener noreferrer",target:"_blank",tabIndex:0,title:"Visit KoL wiki page"},d.createElement("span",{dangerouslySetInnerHTML:{__html:t.name}}),e.inventory[t.id]>0&&d.createElement(d.Fragment,null," ",d.createElement("i",null,"(",e.inventory[t.id],")"))))})),Te=h.exports.memo((function({item:e}){return d.createElement(d.Fragment,null,e.mallPrice&&e.mallPrice.toLocaleString().replace(/,/g,",​"),null!==e.mallPrice&&e.isMallPriceAtMinimum&&d.createElement(ye,null))})),Pe=h.exports.memo((function({item:e,onRuleChange:t,rule:a}){return d.createElement(Ee,{className:"TableItemCleanup__InputKeepAmount",disabled:!a||"KEEP"===a.action,fill:!0,min:0,onChange:a=>{const l=Number(a.target.value);Number.isInteger(l)&&t(e.id,(e=>e&&o(i({},e),{keepAmount:l})))},value:(null==a?void 0:a.keepAmount)||0})})),Se=h.exports.memo((function({item:e,onRuleChange:t,rule:a}){return d.createElement(he,{item:e,onChange:a=>t(e.id,a),rule:a||null})})),ke=h.exports.memo((function(e){var t=e,{className:a,cleanupRules:l,disableReset:n,disableSave:r,inventory:s,items:u,onChange:E,onReset:g,onRuleChange:C,onSave:v}=t,f=m(t,["className","cleanupRules","disableReset","disableSave","inventory","items","onChange","onReset","onRuleChange","onSave"]);const b=h.exports.useCallback(((e,t)=>null==E?void 0:E((a=>{const l="function"==typeof t?t(a[e]||null):t;if(l)return o(i({},a),{[e]:l});{const t=a,{[e]:l}=t;return m(t,[c(e)])}}))),[E]),N=C||b,{sortBy:_,sortDirection:y,updateSortState:I}=Ne(),[T,U]=h.exports.useState(""),z=h.exports.useMemo((()=>{let e;if(T){const t=T.trim().toLowerCase();e=u.filter((e=>e.name.toLowerCase().includes(t)))}else e=[...u];return _&&(((e,t,a)=>{switch(a){case ve.ITEM_NAME:return e.sort(((e,t)=>e.name.localeCompare(t.name)));case ve.CLOSET_AMOUNT:return e.sort(((e,a)=>(t.closet[e.id]||0)-(t.closet[a.id]||0)));case ve.STORAGE_AMOUNT:return e.sort(((e,a)=>(t.storage[e.id]||0)-(t.storage[a.id]||0)));case ve.DISPLAY_CASE_AMOUNT:return e.sort(((e,a)=>(t.displayCase[e.id]||0)-(t.displayCase[a.id]||0)));case ve.MALL_PRICE:return e.sort(((e,t)=>(e.mallPrice||0)-(t.mallPrice||0)));default:be(a)}})(e,s,_),y===P.DESC&&e.reverse()),e}),[T,s,u,_,y]),F=h.exports.useCallback((({index:e})=>z[e]),[z]),K=h.exports.useCallback((({index:e})=>-1===e?"TableItemCleanup__HeaderRow":"TableItemCleanup__Row"),[]),G=h.exports.useCallback((e=>{var t=e,{className:a,getData:l,renderCell:n}=t,r=m(t,["className","getData","renderCell"]);return d.createElement(S,i({cellDataGetter:l&&(e=>l(e.rowData)),cellRenderer:n&&(e=>n(e.rowData)),className:p("TableItemCleanup__Cell",a),flexShrink:0},r))}),[]),B=h.exports.useCallback((e=>{var t=e,{className:a}=t,l=m(t,["className"]);return G(i({className:p(_===l.dataKey&&"TableItemCleanup__Cell--Sorted",a),headerRenderer:_e},l))}),[G,_]),$=h.exports.useMemo((()=>[B({className:"TableItemCleanup__ColumnItemName",dataKey:ve.ITEM_NAME,flexGrow:5,label:"Item (Amount)",renderCell:e=>d.createElement(Ie,{inventory:s,item:e}),width:200}),B({className:"TableItemCleanup__ColumnClosetAmount",dataKey:ve.CLOSET_AMOUNT,getData:e=>s.closet[e.id]||0,label:d.createElement("abbr",{title:"Amount in Closet"},"C"),width:40}),B({className:"TableItemCleanup__ColumnStorageAmount",dataKey:ve.STORAGE_AMOUNT,getData:e=>s.storage[e.id]||0,label:d.createElement("abbr",{title:"Amount in Storage"},"S"),width:40}),B({className:"TableItemCleanup__ColumnDisplayCaseAmount",dataKey:ve.DISPLAY_CASE_AMOUNT,getData:e=>s.displayCase[e.id]||0,label:d.createElement("abbr",{title:"Amount in Display Case"},"D"),width:40}),B({className:"TableItemCleanup__ColumnMallPrice",dataKey:ve.MALL_PRICE,flexGrow:1,label:d.createElement("abbr",{title:"5th lowest mall price"},"Price"),renderCell:e=>d.createElement(Te,{item:e}),width:80}),G({renderCell:e=>d.createElement(Pe,{item:e,onRuleChange:N,rule:l[e.id]}),className:"TableItemCleanup__ColumnKeepAmount",dataKey:"keepAmount",disableSort:!0,label:"Keep",width:70}),G({renderCell:e=>d.createElement(Se,{item:e,onRuleChange:N,rule:l[e.id]}),className:"TableItemCleanup__ColumnAction",dataKey:"action",disableSort:!0,flexGrow:1,label:"Action",width:440})]),[l,N,s,G,B]),j=h.exports.useMemo((()=>d.createElement(k,{className:"TableItemCleanup__EditorButtons"},d.createElement(A,{disabled:r,icon:"saved",onClick:v,text:"Save all"}),d.createElement(A,{disabled:n,icon:"reset",onClick:g,text:"Discard changes"}),d.createElement(x,{className:"TableItemCleanup__PopperFix",popoverClassName:w,content:d.createElement("p",null,"Select an action for each item. These actions will tell Philter how to process each item:",d.createElement(M,null,d.createElement("li",null,"Philter will warn you about uncategorized items, but will not touch them."),d.createElement("li",null,'"Mall sale" will use the lowest mall price ',d.createElement("i",null,"at cleanup"),', but never below the "min price".'),d.createElement("li",null,'"Send as gift" actually uses Kmail, not the gift shop.'),d.createElement("li",null,'"Crafting" can use up other ingredients needed for the recipe, even if you marked them as "Keep all".'),d.createElement("li",null,'"Pulverize" will send items to Smashbot if you can\'t use Pulverize or Malus, but only in aftercore.'),d.createElement("li",null,'"Reminder" will show a reminder message during cleanup, but won\'t touch the item.')))},d.createElement(A,{icon:"help",text:"Help"})))),[n,r,g,v]);return d.createElement("section",i({className:p("TableItemCleanup",a)},f),d.createElement("header",{className:"TableItemCleanup__HeaderMenu"},j,d.createElement(R,{className:"TableItemCleanup__ItemFilterControl"},d.createElement("div",null,"Filter by:"),d.createElement(O,{onChange:h.exports.useCallback((e=>U(e.target.value)),[]),placeholder:"Enter item name...",value:T}),d.createElement("div",{className:"TableItemCleanup__ItemFilterBarHelperText"},T&&`${z.length} / ${u.length} match${z.length>1?"es":""}`))),d.createElement("div",{className:"TableItemCleanup__TableWrapper"},d.createElement(D,null,(({height:e,width:t})=>d.createElement(L,{gridClassName:"TableItemCleanup__Inner",headerClassName:"TableItemCleanup__HeaderCell",headerHeight:30,height:e,rowClassName:K,rowCount:z.length,rowGetter:F,rowHeight:60,sort:I,sortBy:_,sortDirection:y,width:t},$)))),d.createElement("footer",{className:"TableItemCleanup__FooterMenu"},j))})),Ae={all:0,closet:0,craft:0,display:0,dispose:0,gift:0,inventory:0,keep:0,mall:0,pulverize:0,reminder:0,search:0,stash:0,untinker:0,use:0},xe=({cleanupRules:e,onChange:t})=>{const{data:a,error:l,isValidating:n,mutate:r}=K("/cleanup-tables/categorized",(async()=>{const e=await oe("/cleanup-tables/categorized","get",{});return e.result.items.sort(((e,t)=>e.id-t.id)),e.result}));h.exports.useEffect((()=>{(null==a?void 0:a.cleanupRules)&&t((e=>null!=e?e:a.cleanupRules))}),[null==a?void 0:a.cleanupRules,t]);const s=h.exports.useMemo((()=>Boolean(e)&&!G(e,null==a?void 0:a.cleanupRules)),[e,null==a?void 0:a.cleanupRules]),u=h.exports.useCallback((()=>(null==a?void 0:a.cleanupRules)&&t(a.cleanupRules)),[null==a?void 0:a.cleanupRules,t]),{error:p,execute:E,loading:g}=B((()=>r((async t=>{var a;if(!t)throw new Error("Cannot save ruleset when we don't have any data yet");if(!e)throw new Error("Cannot save active ruleset because it has not been initialized yet");const l=await ce(e);if(!(null==(a=null==l?void 0:l.result)?void 0:a.success))throw new Error(`Unexpected response: ${JSON.stringify(l)}`);return o(i({},t),{cleanupRules:e})}),!1)));h.exports.useEffect((()=>ue("savingError",p,"Cannot save cleanup rule")),[p]),h.exports.useEffect((()=>de("isSaving",g,"Saving cleanup rules...")),[g]);const C=h.exports.useCallback(((e,l)=>t((t=>{var n;if(void 0===t)return t;const r=t[e],s="function"==typeof l?l(t[e]||null):l;if(r&&r.action!==(null==s?void 0:s.action)){const t=null==(n=null==a?void 0:a.items.find((t=>t.id===e)))?void 0:n.name;void 0!==t&&(u=s?`Changed action for ${t} to "${(e=>{switch(e){case"AUTO":return"Autosell";case"BREAK":return"Break apart";case"CLAN":return"Put in clan stash";case"CLST":return"Closet";case"DISC":return"Discard";case"DISP":return"Display";case"GIFT":return"Send as gift";case"KEEP":return"Keep all";case"MAKE":return"Craft";case"MALL":return"Mall sale";case"PULV":return"Pulverize";case"TODO":return"Reminder";case"UNTN":return"Untinker";case"USE":return"Use";default:return e}})(s.action)}"`:`Removed action for ${t}`,me.show({icon:"info-sign",message:u}))}var u;if(s)return o(i({},t),{[e]:s});{const a=t,{[e]:l}=a;return m(a,[c(e)])}}))),[null==a?void 0:a.items,t]),[v,f]=h.exports.useState("all"),b=h.exports.useMemo((()=>{var t;return((e,t)=>e.reduce(((e,a)=>{const l=t[a.id];if(l)switch(e.all.push(a),l.action){case"CLST":e.closet.push(a);break;case"MAKE":e.craft.push(a);break;case"AUTO":case"DISC":e.dispose.push(a);break;case"BREAK":case"USE":e.use.push(a);break;case"DISP":e.display.push(a);break;case"KEEP":e.keep.push(a);break;case"GIFT":e.gift.push(a);break;case"MALL":e.mall.push(a);break;case"PULV":e.pulverize.push(a);break;case"TODO":e.reminder.push(a);break;case"UNTN":e.untinker.push(a);break;case"CLAN":e.stash.push(a)}return e}),{all:[],closet:[],craft:[],display:[],dispose:[],gift:[],keep:[],mall:[],pulverize:[],reminder:[],stash:[],untinker:[],use:[]}))(null!=(t=null==a?void 0:a.items)?t:[],e||{})}),[e,null==a?void 0:a.items]),N=!Object.prototype.hasOwnProperty.call(b,v)||b[v].length>0?v:"all",_=t=>e&&a&&d.createElement(ke,{className:"PanelCategorizedItems__Table",disableReset:!s,disableSave:!s,inventory:a.inventory,items:t,cleanupRules:e,onRuleChange:C,onReset:u,onSave:E});return d.createElement(d.Fragment,null,d.createElement($,null,"Edit Cleanup Rules"),a?d.createElement(j,{className:"PanelCategorizedItems__Tabs",onChange:e=>(e=>"string"==typeof e&&Object.prototype.hasOwnProperty.call(Ae,e))(e)&&f(e),renderActiveTabPanelOnly:!0,selectedTabId:N},d.createElement(V,{id:"all",panel:_(b.all),panelClassName:"PanelCategorizedItems__TabItem",title:"All"}),b.keep.length>0&&d.createElement(V,{id:"keep",panel:_(b.keep),panelClassName:"PanelCategorizedItems__TabItem",title:"Keep"}),b.mall.length>0&&d.createElement(V,{id:"mall",panel:_(b.mall),panelClassName:"PanelCategorizedItems__TabItem",title:"Mall"}),b.pulverize.length>0&&d.createElement(V,{id:"pulverize",panel:_(b.pulverize),panelClassName:"PanelCategorizedItems__TabItem",title:"Pulverize"}),b.use.length>0&&d.createElement(V,{id:"use",panel:_(b.use),panelClassName:"PanelCategorizedItems__TabItem",title:"Use"}),b.closet.length>0&&d.createElement(V,{id:"closet",panel:_(b.closet),panelClassName:"PanelCategorizedItems__TabItem",title:"Closet"}),b.stash.length>0&&d.createElement(V,{id:"stash",panel:_(b.stash),panelClassName:"PanelCategorizedItems__TabItem",title:"Clan Stash"}),b.craft.length>0&&d.createElement(V,{id:"craft",panel:_(b.craft),panelClassName:"PanelCategorizedItems__TabItem",title:"Crafting"}),b.untinker.length>0&&d.createElement(V,{id:"untinker",panel:_(b.untinker),panelClassName:"PanelCategorizedItems__TabItem",title:"Untinkering"}),b.gift.length>0&&d.createElement(V,{id:"gift",panel:_(b.gift),panelClassName:"PanelCategorizedItems__TabItem",title:"Gift"}),b.display.length>0&&d.createElement(V,{id:"display",panel:_(b.display),panelClassName:"PanelCategorizedItems__TabItem",title:"Display"}),b.dispose.length>0&&d.createElement(V,{id:"dispose",panel:_(b.dispose),panelClassName:"PanelCategorizedItems__TabItem",title:"Dispose"}),b.reminder.length>0&&d.createElement(V,{id:"reminder",panel:_(b.reminder),panelClassName:"PanelCategorizedItems__TabItem",title:"Reminders"})):n?d.createElement(Y,null):d.createElement(H,{icon:l?"error":"info-sign",title:l?"Failed to load data":"Data not loaded yet",description:l instanceof Error?l.message:void 0}))};const we=h.exports.memo((function(e){var t=e,{fileNamePrefix:a,fileNameSuffix:l,className:n=""}=t,r=m(t,["fileNamePrefix","fileNameSuffix","className"]);return d.createElement(O,i({className:`InputGroupAffixedFileName ${n}`,leftElement:a?d.createElement(W,{className:"InputGroupAffixedFileName__Prefix"},a):void 0,rightElement:l?d.createElement(W,{className:"InputGroupAffixedFileName__Suffix"},l):void 0},r))}));const Me=h.exports.memo((function({changedFiles:e=[],isOpen:t,onCancel:a,onSaveWithCopy:l,onSaveWithoutCopy:n}){return d.createElement(J,{canEscapeKeyClose:!0,canOutsideClickClose:!0,icon:"warning-sign",isOpen:t,onClose:a,title:"Changing data file name"+(e.length>1?"s":"")},d.createElement("div",{className:q},"You are about the change your data file",e.length>1?"s' names":"'s name",":",d.createElement("ul",null,e.map(((e,t)=>d.createElement("li",{key:t},e.label,": ",d.createElement(W,null,e.oldName)," ⇒"," ",d.createElement(W,null,e.newName))))),"Do you want to copy the contents of your previous data file",e.length>1&&"s","?"),d.createElement("div",{className:Q},d.createElement("div",{className:X},d.createElement(A,{icon:"duplicate",text:"Copy contents",onClick:l}),d.createElement(A,{icon:"exchange",text:`Change file name${e.length>1?"s":""} only`,onClick:n}),d.createElement(A,{intent:"danger",text:"Cancel",onClick:a}))))})),Re=(e,t)=>t.includes(e),Oe=()=>{const{data:e,error:t,mutate:a}=K("/config",(async()=>(await oe("/config","get",{})).result)),[l,n]=h.exports.useState(null);h.exports.useEffect((()=>{e&&!l&&n(e)}),[e,l]);const[r,s]=h.exports.useState({}),c=h.exports.useCallback((()=>s({})),[]),{loading:m,execute:u,error:E}=B((async(e,t)=>{var l;const n=await((e,t)=>oe("/config","post",{config:e,shouldCopyDataFiles:t}))(e,t);if(!(null==(l=null==n?void 0:n.result)?void 0:l.success))throw new Error(`Unexpected response: ${JSON.stringify(n)}`);a(e)})),g=h.exports.useCallback((async t=>{if(!l)throw new Error("Cannot save empty config");if(!e)throw new Error("Cannot overwrite an empty config object");const a=[];l.dataFileName!==e.dataFileName&&a.push({label:"Ruleset file",oldName:"OCDdata_"+e.dataFileName+".txt",newName:"OCDdata_"+l.dataFileName+".txt"}),l.stockFileName!==e.stockFileName&&a.push({label:"Stock file",oldName:"OCDstock_"+e.stockFileName+".txt",newName:"OCDstock_"+l.stockFileName+".txt"}),a.length&&void 0===t?s({isOpen:!0,changedFiles:a}):await u(l,t)}),[e,l,u]),C=!G(l,e),v=h.exports.useCallback((e=>n("function"==typeof e?t=>t&&e(t):e)),[]),f=!e||!l||m;h.exports.useEffect((()=>ue("loadingError",t,"Cannot load config")),[t]),h.exports.useEffect((()=>ue("savingError",E,"Cannot save config")),[E]),h.exports.useEffect((()=>de("isSaving",m,"Saving config...")),[m]);const N=f||!(null==l?void 0:l.canUseMallMulti);return d.createElement(d.Fragment,null,d.createElement(Me,i({onCancel:()=>c(),onSaveWithCopy:()=>{c(),g(!0)},onSaveWithoutCopy:()=>{c(),g(!1)}},r)),d.createElement($,null,"Configure Philter"),d.createElement("fieldset",{className:"PanelConfig__Section"},d.createElement("legend",{className:"PanelConfig__SectionTitle"},"General settings"),d.createElement(Z,{disabled:f,inline:!0,label:"Empty closet first before cleanup:",onChange:h.exports.useCallback((({currentTarget:{value:e}})=>{const t=Number(e);Re(t,[0,-1])&&v((e=>o(i({},e),{emptyClosetMode:t})))}),[v]),selectedValue:null==l?void 0:l.emptyClosetMode},d.createElement(ee,{className:l?void 0:te,label:"Never",value:0}),d.createElement(ee,{className:l?void 0:te,label:"Before Emptying Hangk's (recommended)",value:-1})),d.createElement(ae,{className:"PanelConfig__Divider"}),d.createElement(Z,{disabled:f,inline:!0,label:"Mall pricing: ",onChange:h.exports.useCallback((({currentTarget:{value:e}})=>{Re(e,["auto","max"])&&v((t=>o(i({},t),{mallPricingMode:e})))}),[v]),selectedValue:null==l?void 0:l.mallPricingMode},d.createElement(ee,{className:l?void 0:te,label:"Automatic",value:"auto"}),d.createElement(ee,{className:l?void 0:te,label:`${999999999..toLocaleString()} meat (ignores "min price")`,value:"max"})),d.createElement(ae,{className:"PanelConfig__Divider"}),d.createElement(y,{checked:Boolean(null==l?void 0:l.simulateOnly),className:l?void 0:te,disabled:f,onChange:({currentTarget:{checked:e}})=>v((t=>o(i({},t),{simulateOnly:e})))},"Simulate only ",d.createElement("small",null,"(no items will be cleaned up)"))),d.createElement("fieldset",{className:"PanelConfig__Section"},d.createElement("legend",{className:"PanelConfig__SectionTitle"},"Mall multi setup"),d.createElement(y,{checked:Boolean(null==l?void 0:l.canUseMallMulti),className:l?void 0:te,disabled:f,onChange:({currentTarget:{checked:e}})=>v((t=>o(i({},t),{canUseMallMulti:e})))},"Use mall multi"),d.createElement(b,{className:"PanelConfig__FormGroupAligned",disabled:N,inline:!0,intent:N||(null==l?void 0:l.mallMultiName)?void 0:"warning",label:"Mall multi name:",helperText:N||(null==l?void 0:l.mallMultiName)?"​":"No multi account"},d.createElement(O,{className:l?void 0:te,disabled:N,onChange:({target:{value:e}})=>v((t=>o(i({},t),{mallMultiName:e}))),placeholder:N?"":"Enter player name",value:(null==l?void 0:l.mallMultiName)||""})),d.createElement(b,{className:"PanelConfig__FormGroupAligned",disabled:f||!(null==l?void 0:l.canUseMallMulti),inline:!0,label:"Mall multi Kmail text:"},d.createElement(O,{className:l?void 0:te,disabled:f||!(null==l?void 0:l.canUseMallMulti),onChange:({target:{value:e}})=>v((t=>o(i({},t),{mallMultiKmailMessage:e}))),placeholder:N?"":"Enter Kmail message",value:(null==l?void 0:l.mallMultiKmailMessage)||""}))),d.createElement("fieldset",{className:"PanelConfig__Section"},d.createElement("legend",{className:"PanelConfig__SectionTitle"},"Data files"),d.createElement(b,{className:"PanelConfig__FormGroupAligned",disabled:f,inline:!0,label:"Ruleset file:"},d.createElement(we,{className:p("PanelConfig_InputFileName",!l&&te),disabled:f,fileNamePrefix:"OCDdata_",fileNameSuffix:".txt",onChange:h.exports.useCallback((({target:{value:e}})=>v((t=>o(i({},t),{dataFileName:e})))),[v]),value:(null==l?void 0:l.dataFileName)||""})),d.createElement(b,{className:"PanelConfig__FormGroupAligned",disabled:f,inline:!0,label:"Stock file:"},d.createElement(we,{className:p("PanelConfig_InputFileName",!l&&te),disabled:f,fileNamePrefix:"OCDstock_",fileNameSuffix:".txt",onChange:h.exports.useCallback((({target:{value:e}})=>v((t=>o(i({},t),{stockFileName:e})))),[v]),value:(null==l?void 0:l.stockFileName)||""}))),d.createElement(k,null,d.createElement(A,{disabled:f||!C,icon:"floppy-disk",onClick:h.exports.useCallback((()=>g()),[g]),text:"Save"}),d.createElement(A,{disabled:f||!C,icon:"reset",onClick:h.exports.useCallback((()=>e&&n(e)),[e]),text:"Discard changes"})))};const De=d.createElement("span",{className:"PanelInformation__Bullet"},"⋯"),Le=()=>{const{data:e,isValidating:t,error:a}=K("/statistics",(async()=>(await oe("/statistics","get",{})).result)),l=h.exports.useMemo((()=>e?Object.values(e.categorizedItemCounts).reduce(((e,t)=>e+t)):0),[e]);return d.createElement("div",null,d.createElement($,null,d.createElement("a",{href:"https://github.com/Loathing-Associates-Scripting-Society/Philter",rel:"noopener noreferrer",target:"_blank"},"Philter Manager")),d.createElement("p",null,"Brought to you by"," ",d.createElement("a",{href:"https://github.com/Loathing-Associates-Scripting-Society",rel:"noopener noreferrer",target:"_blank"},"Loathing Associates Scripting Society")),d.createElement(le,{intent:"warning",title:"Manager v2 is in alpha"},"Using this ",d.createElement("i",null,"may")," destroy your Philter configuration. Use at your own risk.",d.createElement("br",null),"The"," ",d.createElement("a",{href:"/relay_Philter_Manager_classic.ash?relay=true"},"classic UI")," ","is still available."),e?l>0?d.createElement(ne,{bordered:!0,className:"PanelInformation__VerticalTable",condensed:!0},d.createElement("tbody",null,d.createElement("tr",null,d.createElement("th",{style:e.uncategorizedItemCount>0?{color:f.ORANGE1}:void 0},"Uncategorized (in inventory)"),d.createElement("td",{style:e.uncategorizedItemCount>0?{color:f.ORANGE1}:void 0},e.uncategorizedItemCount)),d.createElement("tr",null,d.createElement("th",null,"Items in Ruleset"),d.createElement("td",null,l)),d.createElement("tr",null,d.createElement("th",null,De," Keep All"),d.createElement("td",null,e.categorizedItemCounts.KEEP)),d.createElement("tr",null,d.createElement("th",null,De," Mallsell"),d.createElement("td",null,e.categorizedItemCounts.MALL)),d.createElement("tr",null,d.createElement("th",null,De," Autosell/Discard"),d.createElement("td",null,e.categorizedItemCounts.AUTO+e.categorizedItemCounts.DISC)),d.createElement("tr",null,d.createElement("th",null,De," Pulverize"),d.createElement("td",null,e.categorizedItemCounts.PULV)),d.createElement("tr",null,d.createElement("th",null,De," Use or break"),d.createElement("td",null,e.categorizedItemCounts.BREAK+e.categorizedItemCounts.USE)),d.createElement("tr",null,d.createElement("th",null,De," Put in closet"),d.createElement("td",null,e.categorizedItemCounts.CLST)),d.createElement("tr",null,d.createElement("th",null,De," Put in clan stash"),d.createElement("td",null,e.categorizedItemCounts.CLAN)),d.createElement("tr",null,d.createElement("th",null,De," Crafting"),d.createElement("td",null,e.categorizedItemCounts.MAKE)),d.createElement("tr",null,d.createElement("th",null,De," Untinker"),d.createElement("td",null,e.categorizedItemCounts.UNTN)),d.createElement("tr",null,d.createElement("th",null,De," Send as gift"),d.createElement("td",null,e.categorizedItemCounts.GIFT)),d.createElement("tr",null,d.createElement("th",null,De," Put in display case"),d.createElement("td",null,e.categorizedItemCounts.DISP)),d.createElement("tr",null,d.createElement("th",null,De," Remind me later"),d.createElement("td",null,e.categorizedItemCounts.TODO)))):d.createElement(H,{icon:"help",description:'If this is your first time using Philter, you can create cleanup rules for your items in the "Add Items" tab.',title:"Your Philter ruleset is empty or missing."}):t?d.createElement(Y,null):d.createElement(H,{icon:a?"error":"info-sign",title:a?"Failed to load data":"Data not loaded yet",description:a instanceof Error?a.message:void 0}))};const Ue=({cleanupRules:e,onChange:t})=>{const{data:a,error:l,isValidating:n,mutate:r}=K("/cleanup-tables/uncategorized",(async()=>{const e=await oe("/cleanup-tables/uncategorized","get",{});return e.result.items.sort(((e,t)=>e.id-t.id)),e.result}));h.exports.useEffect((()=>{(null==a?void 0:a.cleanupRules)&&t((e=>null!=e?e:a.cleanupRules))}),[null==a?void 0:a.cleanupRules,t]);const s=h.exports.useMemo((()=>Boolean(e)&&!G(e,null==a?void 0:a.cleanupRules)),[e,null==a?void 0:a.cleanupRules]),c=h.exports.useCallback((()=>(null==a?void 0:a.cleanupRules)&&t(a.cleanupRules)),[null==a?void 0:a.cleanupRules,t]),{error:u,execute:p,loading:E}=B((()=>r((async t=>{var a;if(!t)throw new Error("Cannot save ruleset when we don't have any data yet");if(!e)throw new Error("Cannot save active ruleset because it has not been initialized yet");const l=await ce(e);if(!(null==(a=null==l?void 0:l.result)?void 0:a.success))throw new Error(`Unexpected response: ${JSON.stringify(l)}`);return o(i({},t),{items:t.items.filter((t=>!(t.id in e))),cleanupRules:e})}),!1)));h.exports.useEffect((()=>ue("savingError",u,"Cannot save cleanup rule")),[u]),h.exports.useEffect((()=>de("isSaving",E,"Saving cleanup rules...")),[E]);const g=h.exports.useCallback((()=>a&&t((e=>{if(void 0===e)return e;const t=m(e,[]);for(const l of a.items)l.canMall&&(t[l.id]={action:"MALL",minPrice:0});return t}))),[a,t]),C=h.exports.useCallback((()=>a&&t((e=>{if(void 0===e)return e;const t=m(e,[]);for(const l of a.items)l.canCloset&&(t[l.id]={action:"CLST"});return t}))),[a,t]),v=h.exports.useCallback((()=>a&&t((e=>{if(void 0===e)return e;const t=m(e,[]);for(const l of a.items)t[l.id]={action:"KEEP"};return t}))),[a,t]),f=h.exports.useCallback((e=>t((t=>t?"function"==typeof e?e(t):e:t))),[t]);return d.createElement(d.Fragment,null,d.createElement($,null,"Uncategorized Items in Your Inventory"),e&&a?a.items.length>0?d.createElement(d.Fragment,null,d.createElement(b,{inline:!0,label:"Categorize all items as..."},d.createElement(k,null,d.createElement(A,{disabled:!a.items.some((t=>{var a;return t.canMall&&"MALL"!==(null==(a=e[t.id])?void 0:a.action)})),onClick:g},"Mallsell"),d.createElement(A,{disabled:!a.items.some((t=>{var a;return t.canCloset&&"CLST"!==(null==(a=e[t.id])?void 0:a.action)})),onClick:C},"Closet"),d.createElement(A,{disabled:!a.items.some((t=>{var a;return"KEEP"!==(null==(a=e[t.id])?void 0:a.action)})),onClick:v},"Keep all"))),d.createElement(ke,{className:"PanelUncategorizedItems__Table",disableReset:!s,disableSave:!s,inventory:a.inventory,items:a.items,cleanupRules:e,onChange:f,onReset:c,onSave:p})):d.createElement(H,{icon:d.createElement("img",{alt:"Nothing to do",src:"/images/adventureimages/kg_accountant.gif"}),title:"Your entire inventory has been categorized",description:'"Nothing to see here, please move along."'}):n?d.createElement(Y,null):d.createElement(H,{icon:l?"error":"info-sign",title:l?"Failed to load data":"Data not loaded yet",description:l instanceof Error?l.message:void 0}))},ze=Object.freeze({categorized:0,config:0,information:0,uncategorized:0}),Fe=e=>Object.prototype.hasOwnProperty.call(ze,e)?e:"information",Ke=()=>{const[e,t]=h.exports.useState("information"),[a,l]=h.exports.useState();return d.createElement("div",{className:"App"},d.createElement(j,{className:"App__Tabs",id:"mainTabs",onChange:e=>t(Fe(e)),renderActiveTabPanelOnly:!0,selectedTabId:Fe(e)},d.createElement(V,{id:"information",panel:d.createElement(Le,null),panelClassName:"App__TabItem",title:"Information"}),d.createElement(V,{id:"uncategorized",panel:d.createElement(Ue,{cleanupRules:a,onChange:l}),panelClassName:"App__TabItem",title:"Add Items"}),d.createElement(V,{id:"categorized",panel:d.createElement(xe,{cleanupRules:a,onChange:l}),panelClassName:"App__TabItem",title:"Edit Rules"}),d.createElement(V,{id:"config",panel:d.createElement(Oe,null),panelClassName:"App__TabItem",title:"Configuration"})))};re.render(d.createElement(d.StrictMode,null,d.createElement(Ke,null)),document.getElementById("root"));
//# sourceMappingURL=philter-manager.index.js.map
