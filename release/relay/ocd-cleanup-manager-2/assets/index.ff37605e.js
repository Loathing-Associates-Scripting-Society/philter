var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,i=(t,a,l)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l,s=(e,t)=>{for(var a in t||(t={}))n.call(t,a)&&i(e,a,t[a]);if(l)for(var a of l(t))r.call(t,a)&&i(e,a,t[a]);return e},o=(e,l)=>t(e,a(l)),c=e=>"symbol"==typeof e?e:e+"",m=(e,t)=>{var a={};for(var i in e)n.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&l)for(var i of l(e))t.indexOf(i)<0&&r.call(e,i)&&(a[i]=e[i]);return a};import{T as u,R as d,H as p,c as g,C as E,a as C,F as h,I as v,b as f,d as b,N as _,A as N,e as I,f as y,B as O,g as k,P as T,h as P,U as x,i as S,j as w,u as A,k as R,l as M,m as z,n as D,S as U,o as F,p as L,D as K,q as G,r as j,s as B,t as V,v as $,w as H,x as W,y as Y,z as J,E as q,G as Q}from"./vendor.d0af24ab.js";var X=Object.freeze({AUTO:0,BREAK:0,CLAN:0,CLST:0,DISC:0,DISP:0,GIFT:0,KEEP:0,MAKE:0,MALL:0,PULV:0,TODO:0,UNTN:0,USE:0});class Z extends Error{constructor(e,t,a){super(e),this.code=t,this.response=a}}Z.prototype.name="ApiError";const ee=async(e,t,a)=>{const l=function(e){for(var t,a={},l=0,n=Object.keys(e);l<n.length;l++){var r=n[l];if("method"===(t=r)||"path"===t)a[r]=e[r];else{var i=JSON.stringify(e[r]);void 0!==i&&(a[r]=i)}}return a}(s({path:e,method:t},a)),n=await fetch("/relay_OCD-Cleanup_Manager_2_(alpha).js?relay=true",{body:new URLSearchParams(l),method:"POST"});if(!n.ok){let e;try{e=await n.text()}catch(i){console.error(i)}throw new Z(n.statusText,n.status,e)}let r;try{r=await n.json()}catch(o){throw new Z(`Invalid JSON returned from server (${o})\nResponse: ${r}`,500,r)}if("error"in r)throw new Z(r.error.message,r.error.code,r.error.message);return r},te=u.create({maxToasts:1}),ae=(e,t,a)=>{t?te.show({icon:"warning-sign",intent:"warning",message:t instanceof Z?d.createElement(d.Fragment,null,a,": ",t.message,d.createElement("br",null),"Response: ",String(t.response)):`${a}: ${t}`},e):te.dismiss(e)},le=(e,t,a)=>{t?te.show({icon:"floppy-disk",intent:"primary",message:a},e):te.dismiss(e)},ne=e=>!e.isTradable;const re=e=>"UNKN"===e||function(e){return"string"==typeof e&&Object.prototype.hasOwnProperty.call(X,e)}(e),ie=d.memo((function(e){var t=e,{className:a,item:l,onChange:n,value:r}=t,i=m(t,["className","item","onChange","value"]);return d.createElement(p,s({className:g("OcdRulePicker__SelectAction",a),onChange:e=>re(e.target.value)&&n(e.target.value),value:r},i),d.createElement("option",{value:"UNKN"},"(uncategorized)"),d.createElement("option",{value:"KEEP"},"Keep all"),l.canMall&&d.createElement("option",{value:"MALL"},"Mall sale"),l.canBreak&&d.createElement("option",{value:"BREAK"},"Break apart"),l.canAutosell&&d.createElement("option",{value:"AUTO"},"Autosell"),l.canDiscard&&d.createElement("option",{style:{color:E.ORANGE2},value:"DISC"},"Discard"),l.canGift&&d.createElement("option",{value:"GIFT"},"Send as gift"),l.canStash&&d.createElement("option",{value:"CLAN"},"Put in clan stash"),l.canPulverize&&d.createElement("option",{style:ne(l)?{color:E.ORANGE2}:void 0,value:"PULV"},"Pulverize"),l.canMake&&d.createElement("option",{value:"MAKE"},"Craft..."),l.canUntinker&&d.createElement("option",{value:"UNTN"},"Untinker"),l.canUse&&d.createElement("option",{value:"USE"},"Use"),l.canCloset&&d.createElement("option",{value:"CLST"},"Closet"),l.canDisplay&&d.createElement("option",{value:"DISP"},"Display"),d.createElement("option",{value:"TODO"},"Reminder"))})),se=({item:e,rule:t,onChange:a})=>{const l=C.exports.useCallback((e=>{a&&a((t=>e===(null==t?void 0:t.action)?t:"UNKN"===e?null:o(s({},t),"GIFT"===e?{action:e,message:"",recipent:""}:"MAKE"===e?{action:e,shouldUseCreatableOnly:!1,targetItem:""}:"MALL"===e?{action:e,minPrice:0}:"TODO"===e?{action:e,message:""}:{action:e})))}),[a]);let n,r;return t&&("PULV"===t.action&&ne(e)?(n="You will pulverize an untradable item.",r=v.WARNING):"DISC"===t.action&&(n="You will gain no meat from discarding.",r=v.WARNING)),d.createElement(h,{className:"OcdRulePicker",helperText:n,intent:r},d.createElement("div",{className:"OcdRulePicker__Inputs"},d.createElement(ie,{className:"OcdRulePicker__Child",item:e,onChange:l,value:t?t.action:"UNKN"}),t?"GIFT"===t.action?d.createElement(d.Fragment,null,d.createElement(h,{className:"OcdRulePicker__Child",contentClassName:"OcdRulePicker__InputGiftRecipent",helperText:!t.recipent&&"No recipent name",inline:!0,intent:t.recipent?void 0:v.DANGER,label:"to"},d.createElement(f,{className:"OcdRulePicker__InputText",intent:t.recipent?void 0:v.DANGER,onChange:e=>null==a?void 0:a(o(s({},t),{recipent:e.target.value})),placeholder:"Player name",small:!0,value:t.recipent})),d.createElement(h,{className:"OcdRulePicker__Child",contentClassName:"OcdRulePicker__InputGiftMessage",inline:!0,label:"with"},d.createElement(f,{className:"OcdRulePicker__InputText",onChange:e=>null==a?void 0:a(o(s({},t),{message:e.target.value})),placeholder:"Kmail message",small:!0,value:t.message}))):"MAKE"===t.action?d.createElement(d.Fragment,null,d.createElement(h,{className:"OcdRulePicker__Child",contentClassName:"OcdRulePicker__InputMakeTarget",helperText:!t.targetItem&&"No item name",inline:!0,intent:t.targetItem?void 0:v.DANGER,label:"into"},d.createElement(f,{className:"OcdRulePicker__InputText",intent:t.targetItem?void 0:v.DANGER,onChange:e=>null==a?void 0:a(o(s({},t),{targetItem:e.target.value})),placeholder:"Item name",small:!0,value:t.targetItem})),d.createElement(b,{checked:t.shouldUseCreatableOnly,className:"OcdRulePicker__Child OcdRulePicker__Checkbox",onChange:e=>null==a?void 0:a(o(s({},t),{shouldUseCreatableOnly:e.currentTarget.checked}))},d.createElement("span",{className:"OcdRulePicker__CheckBoxText"},"Only use available ingredients"))):"MALL"===t.action?d.createElement(h,{className:"OcdRulePicker__Child",contentClassName:"OcdRulePicker__InputMallMinPrice",inline:!0,label:"min price"},d.createElement(_,{majorStepSize:100,max:999999999,min:0,minorStepSize:null,onValueChange:e=>{Number.isInteger(e)&&(null==a||a(o(s({},t),{minPrice:Math.max(0,Math.min(999999999,e))})))},stepSize:1,value:t.minPrice})):"TODO"===t.action?d.createElement(h,{className:"OcdRulePicker__Child",contentClassName:"OcdRulePicker__InputTodoMessage",inline:!0,label:"with message:"},d.createElement(f,{className:"OcdRulePicker__InputText",onChange:e=>null==a?void 0:a(o(s({},t),{message:e.target.value})),placeholder:"Enter reminder message",small:!0,value:t.message})):null:null))},oe=d.memo((function(e){var t=e,{className:a,inventory:l,item:n,onRuleChange:r,rule:i}=t,c=m(t,["className","inventory","item","onRuleChange","rule"]);return d.createElement("div",s({className:`OcdItemTable__Row ${a||""}`},c),d.createElement("div",{className:"OcdItemTable__Cell OcdItemTable__ColumnItemName"},d.createElement(N,{className:"OcdItemTable__ItemImageLink",minimal:!0,onClick:C.exports.useCallback((()=>{return e=n.descid,void(null==(t=window.open(`/desc_item.php?whichitem=${e}`,"name","height=200,width=214"))||t.focus());var e,t}),[n.descid]),title:"View item description"},C.exports.useMemo((()=>d.createElement("img",{className:"OcdItemTable__ItemImage",alt:n.name,src:`/images/itemimages/${n.image}`})),[n])),d.createElement(N,{className:"OcdItemTable__ItemNameLink",href:`https://kol.coldfront.net/thekolwiki/index.php/Special:Search?search=${n.name}&go=Go`,minimal:!0,rel:"noopener noreferrer",target:"_blank",title:"Visit KoL wiki page"},C.exports.useMemo((()=>d.createElement(d.Fragment,null,d.createElement("span",{dangerouslySetInnerHTML:{__html:n.name}}),l.inventory[n.id]>0&&d.createElement(d.Fragment,null," ",d.createElement("i",null,"(",l.inventory[n.id],")")))),[l,n]))),d.createElement("div",{className:"OcdItemTable__Cell OcdItemTable__ColumnClosetAmount"},l.closet[n.id]||0),d.createElement("div",{className:"OcdItemTable__Cell OcdItemTable__ColumnStorageAmount"},l.storage[n.id]||0),d.createElement("div",{className:"OcdItemTable__Cell OcdItemTable__ColumnDisplayCaseAmount"},l.displayCase[n.id]||0),d.createElement("div",{className:"OcdItemTable__Cell OcdItemTable__ColumnMallPrice"},n.mallPrice&&n.mallPrice.toLocaleString().replace(/,/g,",​"),null!=n.mallPrice&&n.isMallPriceAtMinimum&&d.createElement(I,{className:"OcdItemTable__ColumnMallPrice--minimum",htmlTitle:"Is at minimum mall price",intent:"primary",minimal:!0},"min")),d.createElement("div",{className:"OcdItemTable__Cell OcdItemTable__ColumnKeepAmount"},d.createElement(_,{className:"OcdItemTable__InputKeepAmount",disabled:!i||"KEEP"===i.action,fill:!0,majorStepSize:10,min:0,minorStepSize:null,onValueChange:C.exports.useCallback((e=>{Number.isInteger(e)&&r(n.id,(t=>t&&o(s({},t),{keepAmount:e})))}),[n.id,r]),stepSize:1,value:(null==i?void 0:i.keepAmount)||0})),d.createElement("div",{className:"OcdItemTable__Cell OcdItemTable__ColumnAction"},d.createElement(se,{item:n,onChange:C.exports.useCallback((e=>r(n.id,e)),[n.id,r]),rule:i})))}),y),ce=d.memo((function(e){var t=e,{className:a,disableReset:l,disableSave:n,inventory:r,items:i,ocdRules:u,onChange:p,onRuleChange:E,onReset:h,onSave:v}=t,f=m(t,["className","disableReset","disableSave","inventory","items","ocdRules","onChange","onRuleChange","onReset","onSave"]);const b=C.exports.useCallback(((e,t)=>null==p?void 0:p((a=>{const l="function"==typeof t?t(a[e]||null):t;if(l)return o(s({},a),{[e]:l});{const t=a,{[e]:l}=t;return m(t,[c(e)])}}))),[p]),_=C.exports.useRef(),N=C.exports.useRef(!1),I=C.exports.useCallback(((e,t)=>{N.current||void 0===_.current&&(_.current=window.requestAnimationFrame((()=>{var a;_.current=void 0,null==(a=A.current)||a["by"===e?"scrollBy":"scrollTo"]({behavior:"smooth",top:t})})))}),[]);C.exports.useEffect((()=>()=>{void 0!==_.current&&window.cancelAnimationFrame(_.current)}),[]);const y=C.exports.useRef(null),A=C.exports.useRef(null),R=C.exports.useMemo((()=>({inventory:r,items:i,ocdRules:u,onRuleChange:E||b})),[b,r,i,u,E]),M=C.exports.useCallback(((e,t)=>t.items[e].id),[]),z=C.exports.useMemo((()=>d.createElement(O,{className:"OcdItemTable__EditorButtons"},d.createElement(k,{disabled:n,icon:"saved",onClick:v,text:"Save all"}),d.createElement(k,{disabled:l,icon:"reset",onClick:h,text:"Discard changes"}),d.createElement(T,{className:"OcdItemTable__PopperFix",popoverClassName:P,content:d.createElement("p",null,"Select an action for each item. These actions will tell OCD-Cleanup how to process each item:",d.createElement(x,null,d.createElement("li",null,"OCD-Cleanup will warn you about uncategorized items, but will not touch them."),d.createElement("li",null,'"Mall sale" will use the lowest mall price ',d.createElement("i",null,"at cleanup"),', but never below the "min price".'),d.createElement("li",null,'"Send as gift" actually uses Kmail, not the gift shop.'),d.createElement("li",null,'"Crafting" can use up other ingredients needed for the recipe, even if you marked them as "Keep all".'),d.createElement("li",null,'"Pulverize" will send items to Smashbot if you can\'t use Pulverize or Malus, but only in aftercore.'),d.createElement("li",null,'"Reminder" will show a reminder message during cleanup, but won\'t touch the item.')))},d.createElement(k,{icon:"help",text:"Help"})))),[l,n,h,v]),D=C.exports.useCallback((function({data:{ocdRules:e,onRuleChange:t,inventory:a,items:l},index:n,style:r,isScrolling:i=!1}){return N.current=i,d.createElement(oe,{inventory:a,item:l[n],onRuleChange:t,rule:e[l[n].id],style:r})}),[]);return d.createElement("div",s({className:g("OcdItemTable",a)},f),z,d.createElement("div",{className:"OcdItemTable__TableWrapper"},d.createElement(S,{disableWidth:!0},(({height:e})=>d.createElement("div",{className:"OcdItemTable__Inner",onKeyDown:e=>{"ArrowDown"===e.key?e.currentTarget===e.target&&I("by",180):"ArrowUp"===e.key?e.currentTarget===e.target&&I("by",-180):"PageDown"===e.key?I("by",600):"PageUp"===e.key?I("by",-600):"Home"===e.key?I("to",0):"End"===e.key&&y.current&&I("to",parseFloat(y.current.style.height))},tabIndex:-1},d.createElement("div",{className:"OcdItemTable__HeaderRow"},d.createElement("div",{className:"OcdItemTable__HeaderCell OcdItemTable__ColumnItemName"},"Item (Amount)"),d.createElement("div",{className:"OcdItemTable__HeaderCell OcdItemTable__ColumnClosetAmount"},d.createElement("abbr",{title:"Amount in Closet"},"C")),d.createElement("div",{className:"OcdItemTable__HeaderCell OcdItemTable__ColumnStorageAmount"},d.createElement("abbr",{title:"Amount in Storage"},"S")),d.createElement("div",{className:"OcdItemTable__HeaderCell OcdItemTable__ColumnDisplayCaseAmount"},d.createElement("abbr",{title:"Amount in Display Case"},"D")),d.createElement("div",{className:"OcdItemTable__HeaderCell OcdItemTable__ColumnMallPrice"},d.createElement("abbr",{title:"5th lowest mall price"},"Price")),d.createElement("div",{className:"OcdItemTable__HeaderCell OcdItemTable__ColumnKeepAmount"},"Keep"),d.createElement("div",{className:"OcdItemTable__HeaderCell OcdItemTable__ColumnAction"},"Action")),d.createElement(w,{className:"OcdItemTable__Body",height:e,innerRef:y,itemCount:i.length,itemData:R,itemKey:M,itemSize:60,outerRef:A,overscanCount:15,useIsScrolling:!0,width:"100%"},D))))),z)}));const me={all:0,closet:0,craft:0,display:0,dispose:0,gift:0,inventory:0,keep:0,mall:0,pulverize:0,reminder:0,search:0,stash:0,untinker:0,use:0},ue=Object.freeze({}),de=()=>{const{data:e,error:t,isValidating:a,mutate:l}=A("/cleanup-tables/categorized",(async()=>{const e=await ee("/cleanup-tables/categorized","get",{});return e.result.items.sort(((e,t)=>e.id-t.id)),e.result})),[n,r]=C.exports.useState(ue);C.exports.useEffect((()=>{(null==e?void 0:e.ocdRules)&&n===ue&&r(e.ocdRules)}),[n,null==e?void 0:e.ocdRules]);const i=C.exports.useCallback((()=>(null==e?void 0:e.ocdRules)&&r(e.ocdRules)),[null==e?void 0:e.ocdRules]),{error:u,execute:p,loading:g}=R((()=>l((async e=>{var t;if(!e)throw new Error("Cannot save ruleset when we don't have any data yet");const a=await(l=n,ee("/ruleset","post",{ocdRules:l}));var l;if(!(null==(t=null==a?void 0:a.result)?void 0:t.success))throw new Error(`Unexpected response: ${JSON.stringify(a)}`);return o(s({},e),{ocdRules:n})}),!1)));C.exports.useEffect((()=>ae("savingError",u,"Cannot save OCD rule")),[u]),C.exports.useEffect((()=>le("isSaving",g,"Saving OCD rules...")),[g]);const E=C.exports.useCallback(((t,a)=>r((l=>{var n;const r=l[t],i="function"==typeof a?a(l[t]||null):a;if((null==r?void 0:r.action)!==(null==i?void 0:i.action)){const a=null==(n=null==e?void 0:e.items[t])?void 0:n.name;u=i?`Changed action for ${a} to "${(e=>{switch(e){case"AUTO":return"Autosell";case"BREAK":return"Break apart";case"CLAN":return"Put in clan stash";case"CLST":return"Closet";case"DISC":return"Discard";case"DISP":return"Display";case"GIFT":return"Send as gift";case"KEEP":return"Keep all";case"MAKE":return"Craft";case"MALL":return"Mall sale";case"PULV":return"Pulverize";case"TODO":return"Reminder";case"UNTN":return"Untinker";case"USE":return"Use";default:return e}})(i.action)}"`:`Removed action for ${a}`,te.show({icon:"info-sign",message:u})}var u;if(i)return o(s({},l),{[t]:i});{const e=l,{[t]:a}=e;return m(e,[c(t)])}}))),[null==e?void 0:e.items]),[h,v]=C.exports.useState("all"),f=C.exports.useMemo((()=>{var t,a,l;return a=null!=(t=null==e?void 0:e.items)?t:[],l=n||{},a.reduce(((e,t)=>{const a=l[t.id];if(a)switch(e.all.push(t),a.action){case"CLST":e.closet.push(t);break;case"MAKE":e.craft.push(t);break;case"AUTO":case"DISC":e.dispose.push(t);break;case"BREAK":case"USE":e.use.push(t);break;case"DISP":e.display.push(t);break;case"KEEP":e.keep.push(t);break;case"GIFT":e.gift.push(t);break;case"MALL":e.mall.push(t);break;case"PULV":e.pulverize.push(t);break;case"TODO":e.reminder.push(t);break;case"UNTN":e.untinker.push(t);break;case"CLAN":e.stash.push(t)}return e}),{all:[],closet:[],craft:[],display:[],dispose:[],gift:[],keep:[],mall:[],pulverize:[],reminder:[],stash:[],untinker:[],use:[]})}),[null==e?void 0:e.items,n]),b=!f.hasOwnProperty(h)||f[h].length>0?h:"all",_=Boolean(e&&e.ocdRules!==n),N=t=>e&&d.createElement(ce,{className:"PanelCategorizedItems__Table",disableReset:!_,disableSave:!_,inventory:e.inventory,items:t,ocdRules:n,onRuleChange:E,onReset:i,onSave:p});return d.createElement(d.Fragment,null,d.createElement(M,null,"Edit Cleanup Rules"),e?d.createElement(z,{className:"PanelCategorizedItems__Tabs",onChange:e=>(e=>"string"==typeof e&&me.hasOwnProperty(e))(e)&&v(e),renderActiveTabPanelOnly:!0,selectedTabId:b},d.createElement(D,{id:"all",panel:N(f.all),panelClassName:"PanelCategorizedItems__TabItem",title:"All"}),f.keep.length>0&&d.createElement(D,{id:"keep",panel:N(f.keep),panelClassName:"PanelCategorizedItems__TabItem",title:"Keep"}),f.mall.length>0&&d.createElement(D,{id:"mall",panel:N(f.mall),panelClassName:"PanelCategorizedItems__TabItem",title:"Mall"}),f.pulverize.length>0&&d.createElement(D,{id:"pulverize",panel:N(f.pulverize),panelClassName:"PanelCategorizedItems__TabItem",title:"Pulverize"}),f.use.length>0&&d.createElement(D,{id:"use",panel:N(f.use),panelClassName:"PanelCategorizedItems__TabItem",title:"Use"}),f.closet.length>0&&d.createElement(D,{id:"closet",panel:N(f.closet),panelClassName:"PanelCategorizedItems__TabItem",title:"Closet"}),f.stash.length>0&&d.createElement(D,{id:"stash",panel:N(f.stash),panelClassName:"PanelCategorizedItems__TabItem",title:"Clan Stash"}),f.craft.length>0&&d.createElement(D,{id:"craft",panel:N(f.craft),panelClassName:"PanelCategorizedItems__TabItem",title:"Crafting"}),f.untinker.length>0&&d.createElement(D,{id:"untinker",panel:N(f.untinker),panelClassName:"PanelCategorizedItems__TabItem",title:"Untinkering"}),f.gift.length>0&&d.createElement(D,{id:"gift",panel:N(f.gift),panelClassName:"PanelCategorizedItems__TabItem",title:"Gift"}),f.display.length>0&&d.createElement(D,{id:"display",panel:N(f.display),panelClassName:"PanelCategorizedItems__TabItem",title:"Display"}),f.dispose.length>0&&d.createElement(D,{id:"dispose",panel:N(f.dispose),panelClassName:"PanelCategorizedItems__TabItem",title:"Dispose"}),f.reminder.length>0&&d.createElement(D,{id:"reminder",panel:N(f.reminder),panelClassName:"PanelCategorizedItems__TabItem",title:"Reminders"})):a?d.createElement(U,null):d.createElement(F,{icon:t?"error":"info-sign",title:t?"Failed to load data":"Data not loaded yet",description:t instanceof Error?t.message:void 0}))};const pe=d.memo((function(e){var t=e,{fileNamePrefix:a,fileNameSuffix:l,className:n=""}=t,r=m(t,["fileNamePrefix","fileNameSuffix","className"]);return d.createElement(f,s({className:`InputGroupAffixedFileName ${n}`,leftElement:a?d.createElement(L,{className:"InputGroupAffixedFileName__Prefix"},a):void 0,rightElement:l?d.createElement(L,{className:"InputGroupAffixedFileName__Suffix"},l):void 0},r))}));const ge=d.memo((function({changedFiles:e=[],isOpen:t,onCancel:a,onSaveWithCopy:l,onSaveWithoutCopy:n}){return d.createElement(K,{canEscapeKeyClose:!0,canOutsideClickClose:!0,icon:"warning-sign",isOpen:t,onClose:a,title:"Changing data file name"+(e.length>1?"s":"")},d.createElement("div",{className:G},"You are about the change your data file",e.length>1?"s' names":"'s name",":",d.createElement("ul",null,e.map(((e,t)=>d.createElement("li",{key:t},e.label,": ",d.createElement(L,null,e.oldName)," ⇒"," ",d.createElement(L,null,e.newName))))),"Do you want to copy the contents of your previous data file",e.length>1&&"s","?"),d.createElement("div",{className:j},d.createElement("div",{className:B},d.createElement(k,{icon:"duplicate",text:"Copy contents",onClick:l}),d.createElement(k,{icon:"exchange",text:`Change file name${e.length>1?"s":""} only`,onClick:n}),d.createElement(k,{intent:"danger",text:"Cancel",onClick:a}))))})),Ee=(e,t)=>t.includes(e),Ce=()=>{const{data:e,error:t,mutate:a}=A("/config",(async()=>(await ee("/config","get",{})).result)),[l,n]=C.exports.useState(null);C.exports.useEffect((()=>{e&&!l&&n(e)}),[e,l]);const[r,i]=C.exports.useState({}),c=C.exports.useCallback((()=>i({})),[]),{loading:m,execute:u,error:p}=R(C.exports.useCallback((async t=>{var n;if(!l)throw new Error("Cannot save empty config");if(!e)throw new Error("Cannot overwrite an empty config object");const r=[];if(l.dataFileName!==e.dataFileName&&r.push({label:"Ruleset file",oldName:"OCDdata_"+e.dataFileName+".txt",newName:"OCDdata_"+l.dataFileName+".txt"}),l.stockFileName!==e.stockFileName&&r.push({label:"Stock file",oldName:"OCDstock_"+e.stockFileName+".txt",newName:"OCDstock_"+l.stockFileName+".txt"}),r.length&&void 0===t)return void i({isOpen:!0,changedFiles:r});const s=await((e,t)=>ee("/config","post",{config:e,shouldCopyDataFiles:t}))(l,t);if(!(null==(n=null==s?void 0:s.result)?void 0:n.success))throw new Error(`Unexpected response: ${JSON.stringify(s)}`);a(l)}),[e,l,a])),E=!V(l,e),v=C.exports.useCallback((e=>n("function"==typeof e?t=>t&&e(t):e)),[]),_=!e||!l||m;C.exports.useEffect((()=>ae("loadingError",t,"Cannot load config")),[t]),C.exports.useEffect((()=>ae("savingError",p,"Cannot save config")),[p]),C.exports.useEffect((()=>le("isSaving",m,"Saving config...")),[m]);const N=_||!(null==l?void 0:l.canUseMallMulti);return d.createElement(d.Fragment,null,d.createElement(ge,s({onCancel:()=>c(),onSaveWithCopy:()=>{c(),u(!0)},onSaveWithoutCopy:()=>{c(),u(!1)}},r)),d.createElement(M,null,"Configure OCD-Cleanup"),d.createElement("fieldset",{className:"PanelConfig__Section"},d.createElement("legend",{className:"PanelConfig__SectionTitle"},"General settings"),d.createElement($,{disabled:_,inline:!0,label:"Empty closet first before cleanup:",onChange:C.exports.useCallback((({currentTarget:{value:e}})=>{const t=Number(e);Ee(t,[0,-1])&&v((e=>o(s({},e),{emptyClosetMode:t})))}),[v]),selectedValue:null==l?void 0:l.emptyClosetMode},d.createElement(H,{className:l?void 0:W,label:"Never",value:0}),d.createElement(H,{className:l?void 0:W,label:"Before Emptying Hangk's (recommended)",value:-1})),d.createElement(Y,{className:"PanelConfig__Divider"}),d.createElement($,{disabled:_,inline:!0,label:"Mall pricing: ",onChange:C.exports.useCallback((({currentTarget:{value:e}})=>{Ee(e,["auto","max"])&&v((t=>o(s({},t),{mallPricingMode:e})))}),[v]),selectedValue:null==l?void 0:l.mallPricingMode},d.createElement(H,{className:l?void 0:W,label:"Automatic",value:"auto"}),d.createElement(H,{className:l?void 0:W,label:`${999999999..toLocaleString()} meat (ignores "min price")`,value:"max"})),d.createElement(Y,{className:"PanelConfig__Divider"}),d.createElement(b,{checked:Boolean(null==l?void 0:l.simulateOnly),className:l?void 0:W,disabled:_,onChange:({currentTarget:{checked:e}})=>v((t=>o(s({},t),{simulateOnly:e})))},"Simulate only ",d.createElement("small",null,"(no items will be cleaned up)"))),d.createElement("fieldset",{className:"PanelConfig__Section"},d.createElement("legend",{className:"PanelConfig__SectionTitle"},"Mall multi setup"),d.createElement(b,{checked:Boolean(null==l?void 0:l.canUseMallMulti),className:l?void 0:W,disabled:_,onChange:({currentTarget:{checked:e}})=>v((t=>o(s({},t),{canUseMallMulti:e})))},"Use mall multi"),d.createElement(h,{className:"PanelConfig__FormGroupAligned",disabled:N,inline:!0,intent:N||(null==l?void 0:l.mallMultiName)?void 0:"warning",label:"Mall multi name:",helperText:N||(null==l?void 0:l.mallMultiName)?"​":"No multi account"},d.createElement(f,{className:l?void 0:W,disabled:N,onChange:({target:{value:e}})=>v((t=>o(s({},t),{mallMultiName:e}))),placeholder:N?"":"Enter player name",value:(null==l?void 0:l.mallMultiName)||""})),d.createElement(h,{className:"PanelConfig__FormGroupAligned",disabled:_||!(null==l?void 0:l.canUseMallMulti),inline:!0,label:"Mall multi Kmail text:"},d.createElement(f,{className:l?void 0:W,disabled:_||!(null==l?void 0:l.canUseMallMulti),onChange:({target:{value:e}})=>v((t=>o(s({},t),{mallMultiKmailMessage:e}))),placeholder:N?"":"Enter Kmail message",value:(null==l?void 0:l.mallMultiKmailMessage)||""}))),d.createElement("fieldset",{className:"PanelConfig__Section"},d.createElement("legend",{className:"PanelConfig__SectionTitle"},"Data files"),d.createElement(h,{className:"PanelConfig__FormGroupAligned",disabled:_,inline:!0,label:"Ruleset file:"},d.createElement(pe,{className:g("PanelConfig_InputFileName",!l&&W),disabled:_,fileNamePrefix:"OCDdata_",fileNameSuffix:".txt",onChange:C.exports.useCallback((({target:{value:e}})=>v((t=>o(s({},t),{dataFileName:e})))),[v]),value:(null==l?void 0:l.dataFileName)||""})),d.createElement(h,{className:"PanelConfig__FormGroupAligned",disabled:_,inline:!0,label:"Stock file:"},d.createElement(pe,{className:g("PanelConfig_InputFileName",!l&&W),disabled:_,fileNamePrefix:"OCDstock_",fileNameSuffix:".txt",onChange:C.exports.useCallback((({target:{value:e}})=>v((t=>o(s({},t),{stockFileName:e})))),[v]),value:(null==l?void 0:l.stockFileName)||""}))),d.createElement(O,null,d.createElement(k,{disabled:_||!E,icon:"floppy-disk",onClick:C.exports.useCallback((()=>u()),[u]),text:"Save"}),d.createElement(k,{disabled:_||!E,icon:"reset",onClick:C.exports.useCallback((()=>e&&n(e)),[e]),text:"Discard changes"})))};const he=d.createElement("span",{className:"PanelInformation__Bullet"},"⋯"),ve=()=>{const{data:e,isValidating:t,error:a}=A("/statistics",(async()=>(await ee("/statistics","get",{})).result)),l=C.exports.useMemo((()=>e?Object.values(e.categorizedItemCounts).reduce(((e,t)=>e+t)):0),[e]);return d.createElement("div",null,d.createElement(M,null,d.createElement("a",{href:"https://github.com/Loathing-Associates-Scripting-Society/OCD-Cleanup",rel:"noopener noreferrer",target:"_blank"},"OCD-Cleanup Manager")),d.createElement("p",null,"Brought to you by"," ",d.createElement("a",{href:"https://github.com/Loathing-Associates-Scripting-Society",rel:"noopener noreferrer",target:"_blank"},"Loathing Associates Scripting Society")),d.createElement(J,{intent:"warning",title:"Manager v2 is in alpha"},"Using this ",d.createElement("i",null,"may")," destroy your OCD-Cleanup configuration. Use at your own risk.",d.createElement("br",null),"The"," ",d.createElement("a",{href:"/relay_OCD-Cleanup_Manager.ash?relay=true"},"classic OCD-Cleanup Manager")," ","is still available."),d.createElement("div",{style:{height:"0.5em"}}),d.createElement(J,{intent:"primary",title:"OCD-Cleanup will be renamed soon"},"Check out the"," ",d.createElement("a",{href:"https://kolmafia.us/threads/26002/",rel:"noopener noreferrer",target:"_blank"},"discussion thread")," ","or join the"," ",d.createElement("a",{href:"https://forms.gle/tV3eK51hfk9ehEkL8",rel:"noopener noreferrer",target:"_blank"},"poll (Google Forms, requires login)"),"."),e?l>0?d.createElement(q,{bordered:!0,className:"PanelInformation__VerticalTable",condensed:!0},d.createElement("tr",null,d.createElement("th",{style:e.uncategorizedItemCount>0?{color:E.ORANGE1}:void 0},"Uncategorized (in inventory)"),d.createElement("td",{style:e.uncategorizedItemCount>0?{color:E.ORANGE1}:void 0},e.uncategorizedItemCount)),d.createElement("tr",null,d.createElement("th",null,"Items in Ruleset"),d.createElement("td",null,l)),d.createElement("tr",null,d.createElement("th",null,he," Keep All"),d.createElement("td",null,e.categorizedItemCounts.KEEP)),d.createElement("tr",null,d.createElement("th",null,he," Mallsell"),d.createElement("td",null,e.categorizedItemCounts.MALL)),d.createElement("tr",null,d.createElement("th",null,he," Autosell/Discard"),d.createElement("td",null,e.categorizedItemCounts.AUTO+e.categorizedItemCounts.DISC)),d.createElement("tr",null,d.createElement("th",null,he," Pulverize"),d.createElement("td",null,e.categorizedItemCounts.PULV)),d.createElement("tr",null,d.createElement("th",null,he," Use or break"),d.createElement("td",null,e.categorizedItemCounts.BREAK+e.categorizedItemCounts.USE)),d.createElement("tr",null,d.createElement("th",null,he," Put in closet"),d.createElement("td",null,e.categorizedItemCounts.CLST)),d.createElement("tr",null,d.createElement("th",null,he," Put in clan stash"),d.createElement("td",null,e.categorizedItemCounts.CLAN)),d.createElement("tr",null,d.createElement("th",null,he," Crafting"),d.createElement("td",null,e.categorizedItemCounts.MAKE)),d.createElement("tr",null,d.createElement("th",null,he," Untinker"),d.createElement("td",null,e.categorizedItemCounts.UNTN)),d.createElement("tr",null,d.createElement("th",null,he," Send as gift"),d.createElement("td",null,e.categorizedItemCounts.GIFT)),d.createElement("tr",null,d.createElement("th",null,he," Put in display case"),d.createElement("td",null,e.categorizedItemCounts.DISP)),d.createElement("tr",null,d.createElement("th",null,he," Remind me later"),d.createElement("td",null,e.categorizedItemCounts.TODO))):d.createElement(F,{icon:"help",description:'If this is your first time using OCD-Cleanup, you can create cleanup rules for your items in the "Add Items" tab.',title:"Your OCD-Cleanup ruleset is empty or missing."}):t?d.createElement(U,null):d.createElement(F,{icon:a?"error":"info-sign",title:a?"Failed to load data":"Data not loaded yet",description:a instanceof Error?a.message:void 0}))};const fe={},be=()=>{const{data:e,error:t,isValidating:a,mutate:l}=A("/cleanup-tables/uncategorized",(async()=>{const e=await ee("/cleanup-tables/uncategorized","get",{});return e.result.items.sort(((e,t)=>e.id-t.id)),e.result})),[n,r]=C.exports.useState(fe),i=C.exports.useCallback((()=>r(fe)),[]),s=C.exports.useMemo((()=>!V(n,fe)),[n]),{error:o,execute:c,loading:u}=R((async()=>{var e;const t=await(a=n,ee("/ruleset","patch",{ocdRulesPatch:a}));var a;if(!(null==(e=null==t?void 0:t.result)?void 0:e.success))throw new Error(`Unexpected response: ${JSON.stringify(t)}`);l(),i()}));C.exports.useEffect((()=>ae("savingError",o,"Cannot save OCD rule")),[o]),C.exports.useEffect((()=>le("isSaving",u,"Saving OCD rules...")),[u]);const p=C.exports.useCallback((()=>e&&r((t=>{var a=m(t,[]);for(const l of e.items)l.canMall&&(a[l.id]={action:"MALL",minPrice:0});return a}))),[e]),g=C.exports.useCallback((()=>e&&r((t=>{var a=m(t,[]);for(const l of e.items)l.canCloset&&(a[l.id]={action:"CLST"});return a}))),[e]),E=C.exports.useCallback((()=>e&&r((t=>{var a=m(t,[]);for(const l of e.items)a[l.id]={action:"KEEP"};return a}))),[e]);return d.createElement(d.Fragment,null,d.createElement(M,null,"Uncategorized Items in Your Inventory"),e?e.items.length>0?d.createElement(d.Fragment,null,d.createElement(h,{inline:!0,label:"Categorize all items as..."},d.createElement(O,null,d.createElement(k,{disabled:!e.items.some((e=>{var t;return e.canMall&&"MALL"!==(null==(t=n[e.id])?void 0:t.action)})),onClick:p},"Mallsell"),d.createElement(k,{disabled:!e.items.some((e=>{var t;return e.canCloset&&"CLST"!==(null==(t=n[e.id])?void 0:t.action)})),onClick:g},"Closet"),d.createElement(k,{disabled:!e.items.some((e=>{var t;return"KEEP"!==(null==(t=n[e.id])?void 0:t.action)})),onClick:E},"Keep all"))),d.createElement(ce,{className:"PanelUncategorizedItems__Table",disableReset:!s,disableSave:!s,inventory:e.inventory,items:e.items,ocdRules:n,onChange:r,onReset:i,onSave:c})):d.createElement(F,{icon:d.createElement("img",{alt:"Nothing to do",src:"/images/adventureimages/kg_accountant.gif"}),title:"Your entire inventory has been categorized",description:'"Nothing to see here, please move along."'}):a?d.createElement(U,null):d.createElement(F,{icon:t?"error":"info-sign",title:t?"Failed to load data":"Data not loaded yet",description:t instanceof Error?t.message:void 0}))},_e=Object.freeze({categorized:0,config:0,information:0,uncategorized:0}),Ne=e=>_e.hasOwnProperty(e)?e:"information",Ie=()=>{const[e,t]=C.exports.useState("information");return d.createElement("div",{className:"App"},d.createElement(z,{className:"App__Tabs",id:"mainTabs",onChange:e=>t(Ne(e)),renderActiveTabPanelOnly:!0,selectedTabId:Ne(e)},d.createElement(D,{id:"information",panel:d.createElement(ve,null),panelClassName:"App__TabItem",title:"Information"}),d.createElement(D,{id:"uncategorized",panel:d.createElement(be,null),panelClassName:"App__TabItem",title:"Add Items"}),d.createElement(D,{id:"categorized",panel:d.createElement(de,null),panelClassName:"App__TabItem",title:"Edit Rules"}),d.createElement(D,{id:"config",panel:d.createElement(Ce,null),panelClassName:"App__TabItem",title:"Configuration"})))};Q.render(d.createElement(d.StrictMode,null,d.createElement(Ie,null)),document.getElementById("root"));
//# sourceMappingURL=index.ff37605e.js.map
